
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>fontus &#8212; ede  documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">ede  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fontus</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains the classes fontus, stations, parameters and plotting</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Lukas Calmbach&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">database</span> <span class="k">as</span> <span class="nn">db</span>
<span class="kn">import</span> <span class="nn">locale</span>

<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">pyperclip</span> <span class="k">as</span> <span class="nn">clipboard</span>
<span class="kn">import</span> <span class="nn">pydeck</span> <span class="k">as</span> <span class="nn">pdk</span>
<span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>

<span class="kn">import</span> <span class="nn">config</span> <span class="k">as</span> <span class="nn">cn</span>
<span class="kn">import</span> <span class="nn">tools</span>


<div class="viewcode-block" id="Fontus"><a class="viewcode-back" href="../fontus.html#fontus.Fontus">[docs]</a><span class="k">class</span> <span class="nc">Fontus</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class holds data on: </span>
<span class="sd">    - the database connection</span>
<span class="sd">    - the available data collection in the database</span>
<span class="sd">    - the current data collection</span>
<span class="sd">    - the available datasets in the current data collectin</span>
<span class="sd">    - the current dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new fontus session consisting of a data collection and sets id as the current data collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">db</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Use &#39;&#39; for auto, or force e.g. to &#39;en_US.UTF-8&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__menu</span> <span class="o">=</span> <span class="s1">&#39;Info&#39;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM envdata.v_data_collections&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dfAll_data_collections</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfAll_data_collections</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">DATA_COLLECTION_NAME_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfAll_data_collections</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_display</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_options</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dfAll_data_collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfAll_data_collections</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_id</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># init attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent_id</span> <span class="o">=</span> <span class="n">cn</span><span class="o">.</span><span class="n">DEFAULT_DATA_COLLECTION_ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plots</span> <span class="o">=</span> <span class="n">Plots</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a plots objects which is used to render plots and plots related</span>
<span class="sd">        UI controls</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plots</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;menu selection: info, plotting, parameters info, stations info&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__menu</span>

    <span class="nd">@menu</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menuitem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;menu selection: info, plotting, parameters info, stations info&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__menu</span> <span class="o">=</span> <span class="n">menuitem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">fill_controls</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Object holding all filter settings&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filter</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dfAll_data_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;data frame holding all available data collection in the database&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfAll_data_collections</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_collection_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_id</span>

    <span class="nd">@data_collection_id</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data_collection_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;initializes the data collection id. sets parameter data_collection_id and reads related data from db&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_id</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;sets the attribute data_collection_id and retrieves a dataframe of all datasets belonging to the current datacollection&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_id</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM envdata.v_datasets where data_collection_id = </span><span class="si">{}</span><span class="s2"> order by </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span>
                                                                                                        <span class="n">cn</span><span class="o">.</span><span class="n">DATASET_NAME_COLUMN</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dfDatasets</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfDatasets</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">DATASET_NAME_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dataset_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfDatasets</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dataset_display</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_options</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__google_maps_url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># set the new dataset_id</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT min(id) as id FROM envdata.v_datasets where data_collection_id = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__menu</span> <span class="o">=</span> <span class="s1">&#39;Info&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observations_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return view name for observations of the selected dataset&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__observations_view</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameter_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return view name for the parameters tble of the selected dataset&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parameter_view</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">google_maps_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__google_maps_url</span>

<div class="viewcode-block" id="Fontus.has_google_maps_url"><a class="viewcode-back" href="../fontus.html#fontus.Fontus.has_google_maps_url">[docs]</a>    <span class="k">def</span> <span class="nf">has_google_maps_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__google_maps_url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataset_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the dataset_id&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataset_id</span>

    <span class="nd">@dataset_id</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dataset_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets the dataset_id and retrieves a dataframe of all datasets belonging to the current data collection&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dataset_id</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM envdata.v_datasets where id = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__observations_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;result_view&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parameter_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;parameter_view&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__first_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;first_year&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__last_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;last_year&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__google_maps_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;google_maps_url&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__has_markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;has_markers&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;data_type_id&#39;</span><span class="p">]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM envdata.list_field where dataset_id = </span><span class="si">{}</span><span class="s2"> order by order_id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataset_id</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filter</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__station_main_display_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;station_station_cols&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__station_samples_display_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;station_samples&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__station_years_display_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfCurr_dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;station_samples_per_year&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parameters</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__stations</span> <span class="o">=</span> <span class="n">Stations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">station_main_display_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sql string querying columns for station display view, menu item stations info&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__station_main_display_view</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">station_samples_display_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sql string querying columns for station display view, menu item stations info&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__station_samples_display_view</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">station_years_display_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sql string querying columns for station display view, menu item stations info&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__station_years_display_view</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">first_year</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Year of first sample collection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_year</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns data type for selected dataset:</span>
<span class="sd">        1:  chemistry</span>
<span class="sd">        2:  precipitation</span>
<span class="sd">        3:  water levels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If True data points in plots will be shown as circles&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__has_markers</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_year</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Year of most recent sample collection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_year</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">curr_data_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Data frame holding current data collection record&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curr_data_collection</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_collection_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List of ids from data_collection table. the list is used to fill the data collection selection control&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_collection_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_display</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataset_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List of ids from dataset table. the list is used to fill the dataset selection control&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataset_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataset_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dictionary of dataset id:name pairs for current data collection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataset_display</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stations object associated with current data collection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stations</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameters object associated with current data collection&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parameters</span>

<div class="viewcode-block" id="Fontus.show_url_list"><a class="viewcode-back" href="../fontus.html#fontus.Fontus.show_url_list">[docs]</a>    <span class="k">def</span> <span class="nf">show_url_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In table refererence url references realted to each data collection can be defined and rendered with this function&quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select html_reference from envdata.v_references where object_type_id = 1 and object_id = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parent_id</span><span class="p">)</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="s1">&#39;html_reference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;    * </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ref</span><span class="p">),</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fontus.get_values"><a class="viewcode-back" href="../fontus.html#fontus.Fontus.get_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a data frame with all values matching the criteria&quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;Select * from </span><span class="si">{}</span><span class="s2"> where </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observations_view</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Fontus.render_about_text"><a class="viewcode-back" href="../fontus.html#fontus.Fontus.render_about_text">[docs]</a>    <span class="k">def</span> <span class="nf">render_about_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Renders info on the selected data collection composed of: a header image, some explenatory text, a metadatatable for the</span>
<span class="sd">        data collection and metadata for each dataset included in the data collection&quot;&quot;&quot;</span>

        <span class="n">myid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_collection_id</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfAll_data_collections</span>
        <span class="n">st</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s1">&#39;static/images/&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">myid</span><span class="p">,</span> <span class="s1">&#39;about_image&#39;</span><span class="p">])</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">myid</span><span class="p">,</span> <span class="s1">&#39;name_long&#39;</span><span class="p">])</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">myid</span><span class="p">,</span> <span class="s1">&#39;about_text&#39;</span><span class="p">]</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># metadata for </span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;### Metadata from data owner:&#39;</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;* Publisher: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">myid</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">]))</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;* Update frequency: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">myid</span><span class="p">,</span> <span class="s1">&#39;update_frequency&#39;</span><span class="p">]))</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;* Geographical coverage: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">myid</span><span class="p">,</span> <span class="s1">&#39;geographical_coverage&#39;</span><span class="p">]))</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;** Additional information on data collection: **&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_url_list</span><span class="p">()</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfDatasets</span>
        <span class="n">list_of_dataset_ids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;### Summary of datasets available in the data collection:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">list_of_dataset_ids</span><span class="p">:</span>
            <span class="n">n_samples</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;number_of_samples&#39;</span><span class="p">]</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">]</span>

            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;#### Dataset: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">description</span> <span class="o">&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;* *Description*: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">description</span><span class="p">))</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;* *Number of stations*: </span><span class="si">{0:n}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;number_of_stations&#39;</span><span class="p">]))</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;* *Number of parameters*: </span><span class="si">{0:n}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;number_of_parameters&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;* *Number of sampling events*: </span><span class="si">{0:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_samples</span><span class="p">))</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;* *Number of observations*: </span><span class="si">{0:n}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;number_of_observations&#39;</span><span class="p">]))</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
                <span class="s1">&#39;* *Time interval covered*: </span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;first_year&#39;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;last_year&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Fontus.render_help"><a class="viewcode-back" href="../fontus.html#fontus.Fontus.render_help">[docs]</a>    <span class="k">def</span> <span class="nf">render_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renders a help icon linking to the &lt;read the docs&gt; user manual&quot;&quot;&quot;</span>

        <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
            <span class="s1">&#39;&lt;a href = &quot;</span><span class="si">{}</span><span class="s1">&quot; target = &quot;_blank&quot;&gt;&lt;img border=&quot;0&quot; alt=&quot;Help&quot; src=&quot;</span><span class="si">{}</span><span class="s1">&quot;&gt;&lt;/a&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">USER_MANUAL_LINK</span><span class="p">,</span>
                                                                                               <span class="n">cn</span><span class="o">.</span><span class="n">HELP_ICON</span><span class="p">),</span>
                                                                                               <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Filter"><a class="viewcode-back" href="../fontus.html#fontus.Filter">[docs]</a><span class="k">class</span> <span class="nc">Filter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; This class holds all filter control</span>
<span class="sd">    filter_stations_cb       if set, selected station attributes are shown to build a station filter</span>
<span class="sd">    station_list  a station multi list allowing to select multiple stations</span>
<span class="sd">    station_list</span>
<span class="sd">    filter_by_year_cb</span>
<span class="sd">    filter_year_slider</span>
<span class="sd">    filter_season_list</span>
<span class="sd">    x_list            x parameter</span>
<span class="sd">    x_list            y parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">df_fields</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;initializes the filter.</span>
<span class="sd">        :param parent: parent of current object</span>
<span class="sd">        :param df_fields: data frame of filter fields</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df_filter_fields</span> <span class="o">=</span> <span class="n">df_fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters_multilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__station_fields_multilist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__station_field_options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_multilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_multilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_list</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">year_slider</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">season_list</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__station_main_display_view</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__station_samples_display_view</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__station_years_display_view</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<div class="viewcode-block" id="Filter.fill_controls"><a class="viewcode-back" href="../fontus.html#fontus.Filter.fill_controls">[docs]</a>    <span class="k">def</span> <span class="nf">fill_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fills the dictionary __station_fields_multilist with all filter options for each menu item.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df_filter_fields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">type_id</span> <span class="o">=</span> <span class="n">cn</span><span class="o">.</span><span class="n">dict_menu_filter_type</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">menu</span><span class="p">]</span>
            <span class="n">dfFilters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df_filter_fields</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df_filter_fields</span><span class="o">.</span><span class="n">type_id</span> <span class="o">==</span> <span class="n">type_id</span><span class="p">)]</span>
            <span class="n">dfFilters</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dfFilters</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__station_fields_multilist</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FilterItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__station_field_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">station_fields_multilist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the dictionary of filter controls for station filters. For example if the user selects aquifer and</span>
<span class="sd">        county from the list of available filterable fields, then two select boxes are shown to the user.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__station_fields_multilist</span>

<div class="viewcode-block" id="Filter.FilterItem"><a class="viewcode-back" href="../fontus.html#fontus.Filter.FilterItem">[docs]</a>    <span class="k">class</span> <span class="nc">FilterItem</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter item is used to dynamically generate UI station and parameter filter controls values are stored in</span>
<span class="sd">        table list_field.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select distinct </span><span class="si">{0}</span><span class="s2"> from </span><span class="si">{1}</span><span class="s2"> where dataset_id = </span><span class="si">{2}</span><span class="s2"> order by </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                                                              <span class="n">cn</span><span class="o">.</span><span class="n">dict_menu_menu_view</span><span class="p">[</span>
                                                                                              <span class="n">parent</span><span class="o">.</span><span class="n">menu</span><span class="p">],</span>
                                                                                              <span class="n">parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a filter expression depending on the menu context.&quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__station_fields_multilist</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__station_fields_multilist</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lis</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_cs_item_list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> in (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="s1">&#39; AND &#39;</span> <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">item</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="n">lis</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Filter.append_parameter_filter"><a class="viewcode-back" href="../fontus.html#fontus.Filter.append_parameter_filter">[docs]</a>    <span class="k">def</span> <span class="nf">append_parameter_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Appends a filter for x and y parameters for plots.</span>

<span class="sd">        :param criteria: where clause for sql statement</span>

<span class="sd">        :return result: initial criteria with additional filter for x and y parameter for scatter plots</span>
<span class="sd">                and y parameter only for most other plot types</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">criteria</span>
        <span class="c1"># in the plotting mode, parameters must be filtered for null values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">menu</span> <span class="o">==</span> <span class="s2">&quot;Plotting&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;scatter plot&#39;</span><span class="p">:</span>
                <span class="n">par_list</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_cs_item_list</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">xpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">ypar</span><span class="p">])</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> in (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="s1">&#39; AND &#39;</span> <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;parameter_id&#39;</span><span class="p">,</span> <span class="n">par_list</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{}</span><span class="s2"> lat is not null and lon is not null and not (lat = 0 and lon = 0)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="p">(</span><span class="s1">&#39; AND &#39;</span> <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2"> AND calc_value is not null&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="s1">&#39; AND &#39;</span> <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                                                                          <span class="s1">&#39;parameter_id&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">ypar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Filter.render_menu"><a class="viewcode-back" href="../fontus.html#fontus.Filter.render_menu">[docs]</a>    <span class="k">def</span> <span class="nf">render_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Renders the filter menu. The filters_multilist is a list of filter objects read from the database</span>
<span class="sd">        each having a labal, default values und an options list, including all distinct values that should appear in the</span>
<span class="sd">        options list in the select box control for this filter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;#### Data filters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters_multilist</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">multiselect</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filter data by&#39;</span><span class="p">,</span>
                                                        <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filters_multilist</span><span class="p">,</span>
                                                        <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__station_field_options</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">filt_fld</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters_multilist</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__station_fields_multilist</span><span class="p">[</span><span class="n">filt_fld</span><span class="p">]</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span>
            <span class="k">if</span> <span class="n">filt_fld</span> <span class="o">==</span> <span class="s1">&#39;station&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">stations</span><span class="o">.</span><span class="n">refresh_options</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">filt_fld</span> <span class="o">==</span> <span class="s1">&#39;parameter&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">refresh_options</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">multiselect</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                                                <span class="n">options</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">options</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Stations"><a class="viewcode-back" href="../fontus.html#fontus.Stations">[docs]</a><span class="k">class</span> <span class="nc">Stations</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Holds all information on the stations related to the current dataset&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Stations objects holding all functions related to the station selection</span>
<span class="sd">        :param parent: session object, holding definition of data collection and dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span> <span class="o">=</span> <span class="n">parent</span>

<div class="viewcode-block" id="Stations.refresh_options"><a class="viewcode-back" href="../fontus.html#fontus.Stations.refresh_options">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the list of stations. if a criteria is specified, only stations matching the criteria are</span>
<span class="sd">        used in the list.</span>
<span class="sd">        :param criteria: sql where clause</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">criteria</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT station_name FROM envdata.v_stations where number_of_samples &gt; 0 and dataset_id = </span><span class="si">{0}</span><span class="s2"> </span>
<span class="s2">                    order by </span><span class="si">{1}</span><span class="s2">;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">STATION_NAME_COLUMN</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT station_name FROM envdata.v_stations where number_of_samples &gt; 0 and dataset_id = </span><span class="si">{0}</span><span class="s2"> </span>
<span class="s2">                    and </span><span class="si">{1}</span><span class="s2"> order by </span><span class="si">{2}</span><span class="s2">;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">criteria</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">STATION_NAME_COLUMN</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">STATION_NAME_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">lis</span></div>

<div class="viewcode-block" id="Stations.get_table"><a class="viewcode-back" href="../fontus.html#fontus.Stations.get_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadata for all stations, if no station is selected, or the selected stations.</span>
<span class="sd">        :param criteria:</span>
<span class="sd">        :return: table as DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">criteria</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">station_main_display_view</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;1=1&#39;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Field&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="p">[]})</span>
            <span class="n">st_lis</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_cs_item_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_multilist</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">station_main_display_view</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transpose_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Stations.get_samples"><a class="viewcode-back" href="../fontus.html#fontus.Stations.get_samples">[docs]</a>    <span class="k">def</span> <span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sqlstr</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a DataFrame of samples as a DataFrame where column 0 is the field name and column 1 is its value&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">cn</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="s1">&#39;t1.station_id&#39;</span><span class="p">)</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;parameter_id&#39;</span><span class="p">,</span> <span class="s1">&#39;t1.parameter_id&#39;</span><span class="p">)</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;dataset_id&#39;</span><span class="p">,</span> <span class="s1">&#39;t1.dataset_id&#39;</span><span class="p">)</span>
            <span class="c1"># index_col = &#39;station_name&#39;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">sqlstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Stations.draw_map"><a class="viewcode-back" href="../fontus.html#fontus.Stations.draw_map">[docs]</a>    <span class="k">def</span> <span class="nf">draw_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station_name</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws a map of all selected stations. If no filter is set, all stations are shown.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">criteria</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select lat, lon, id as value from v_stations where dataset_id = </span><span class="si">{}</span><span class="s2"> and not (lat = 0 and lon = 0)</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;All stations in dataset&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select lat, lon, id as value from v_stations where dataset_id = </span><span class="si">{}</span><span class="s2"> and not (lat = 0 and lon = 0) </span>
<span class="s2">                    and </span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">station_name</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="c1"># make sure the station as coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;ScatterplotLayer&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">has_google_maps_url</span><span class="p">():</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[View all wells on my google maps](</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">google_maps_url</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stations.get_yearly_sample_summary_table"><a class="viewcode-back" href="../fontus.html#fontus.Stations.get_yearly_sample_summary_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_yearly_sample_summary_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a DataFrame with 1 record for every year when samples were collected&quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">station_years_display_view</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Stations.render_menu"><a class="viewcode-back" href="../fontus.html#fontus.Stations.render_menu">[docs]</a>    <span class="k">def</span> <span class="nf">render_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renders the station info menu controls and calls the procedures to show tables and a map for all or the</span>
<span class="sd">        selected stations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># sidebar menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">render_menu</span><span class="p">()</span>

        <span class="c1"># content either html table of DataFrame</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">get_expression</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
        <span class="n">station_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># df.reset_index(inplace = True) #needed so station_name can be selected on plotly table</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">station_name</span> <span class="o">=</span> <span class="n">lis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;#### </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station_name</span><span class="p">))</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># make sure first column is exported</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">get_table_download_link</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># sample summary table</span>
            <span class="c1"># criteria = &quot;{0} = {1} and {2} = {3}&quot;.format(&#39;station_id&#39;, self.__parent.filter.station_multilist[0], &#39;dataset_id&#39;, self.__parent.dataset_id)</span>
            <span class="c1"># show samples belonging to sample</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">station_samples_display_view</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>

            <span class="n">number_of_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

            <span class="c1"># title is different for chem samples and time series, with only 1 parameter</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">cn</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="c1"># sample summary table</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;#### </span><span class="si">{0}</span><span class="s1"> has </span><span class="si">{1}</span><span class="s1"> samples&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station_name</span><span class="p">,</span> <span class="n">number_of_samples</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">get_table_download_link</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># yearly summary table</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yearly_sample_summary_table</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;#### Samples by year&#39;</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;#### Summary of measurements at station </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station_name</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;#### Selected stations (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="c1"># column_values = [df[cn.STATION_NAME_COLUMN], df.aquifer_lithology, df.stratigraphy, df.well_depth, df.screen_hole, df.min_sample_year, df.max_sample_year, df.number_of_samples]</span>
            <span class="c1"># tools.show_table(df, column_values)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">get_table_download_link</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">station_name</span><span class="p">)</span>  <span class="c1"># copy station name to clipboard so it can be pasted into google map if required</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_map</span><span class="p">(</span><span class="n">station_name</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stations.get_values"><a class="viewcode-back" href="../fontus.html#fontus.Stations.get_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a data frame with all values matching the criteria&quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;Select * from v_stations where </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
        <span class="c1"># st.write(query)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../fontus.html#fontus.Parameters">[docs]</a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select id, </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">, </span><span class="si">{2}</span><span class="s2"> from envdata.parameter where dataset_id = </span><span class="si">{3}</span><span class="s2"> order by </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">cn</span><span class="o">.</span><span class="n">PAR_NAME_COLUMN</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">PAR_LABEL_COLUMN</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">PAR_UNIT_COLUMN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">PAR_NAME_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parameters_options</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parameters_display</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parameters_options</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dfParameters</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dfParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dfParameters</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parameters_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parameters_display</span>

<div class="viewcode-block" id="Parameters.refresh_options"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.refresh_options">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;generates the list of parameters. if a criteria is specified, only parameters matching the criteria are</span>
<span class="sd">        used in the list. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">criteria</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT parameter_name FROM envdata.v_parameters where dataset_id = </span><span class="si">{0}</span><span class="s2"> order by parameter_name;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT parameter_name FROM envdata.v_parameters where dataset_id = </span><span class="si">{0}</span><span class="s2"> and </span><span class="si">{1}</span><span class="s2"> order by  parameter_name;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">PAR_NAME_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">[</span><span class="s1">&#39;parameter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">lis</span></div>

    <span class="c1"># def get_table(self):</span>
    <span class="c1">#    &quot;&quot;&quot;Returns a list of parameters matching the filters set. If no filter is set, all parameters are shown. if a single parameter is selected</span>
    <span class="c1">#    more detail about the selected parameter is shown including a link to more information on NIH Toxnet&quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#        st.write(self.__parent.filter.station_fields_multilist[&#39;parameter&#39;].value)</span>
    <span class="c1">###        if self.__parent.filter.station_fields_multilist[&#39;parameter&#39;].value == []:</span>
    <span class="c1">#            query = &quot;&quot;&quot;select t1.parameter_name, t1.formula, t1.unit, t2.min_value, t2.max_value, t2.average_value, t2.number_of_values</span>
    <span class="c1">#            from envdata.v_parameters where parameter_id in ({})&quot;&quot;&quot;.format(self.__parent.dataset_id, self.__parent.filter.station_fields_multilist[&#39;parameter&#39;].options)</span>
    <span class="c1">#            result = db.execute_query(query)</span>
    <span class="c1">#        else:</span>
    <span class="c1">#            stations = tools.get_cs_item_list(lst = self.__parent.filter.station_multilist, separator = &#39;,&#39;, quote_string = &#39;&#39;)</span>
    <span class="c1">#            query = &quot;&quot;&quot;select t1.parameter_name, t1.formula, t1.unit, t2.min_value, t2.max_value, t2.average_value, t2.number_of_values from</span>
    <span class="c1">##                        envdata.v_parameters t1</span>
    <span class="c1">##                        inner join (select parameter_id, min(calc_value) min_value, max(calc_value) max_value, avg(calc_value) average_value, count(*) as number_of_values from</span>
    <span class="c1">#                        envdata.v_observations where dataset_id = {} and station_id in ({}) group by parameter_id) t2 on t2.parameter_id = t1.id&quot;&quot;&quot;.format(self.__parent.dataset_id, stations)</span>
    <span class="c1">#            result = db.execute_query(query)</span>
    <span class="c1">#        return result</span>

    <span class="c1"># def get_sample_parameters(self, station_name):</span>
    <span class="c1">#    # filter samples to include only samples listed in the rivers-selection</span>
    <span class="c1">#    result = db.dfValues[(db.dfValues[cn.STATION_NAME_COLUMN].isin(station_name))]</span>
    <span class="c1">#    # make unqique list of parameters from the filtered table</span>
    <span class="c1">#    lst_par = result.PARM.unique()</span>
    <span class="c1">#    # filter the parameter table to include only parameters from the filtered sample list</span>
    <span class="c1">#    result = db.dfParameters[(db.dfParameters[cn.PAR_NAME_COLUMN].isin(lst_par))]</span>
    <span class="c1">#    result = result.PARM_DESCRIPTION</span>
    <span class="c1">#</span>
    <span class="c1">#    return result.tolist()</span>

    <span class="c1"># returns the key for a given parameter description. the lists hold parameter descriptions, so they are easier to understand</span>
    <span class="c1"># in the graphs, we need to reference the keys. e.g. Description: CALCIUM and key: CAUT.</span>
    <span class="c1"># def get_parameter_key(self, par_label):</span>
    <span class="c1">#    query = &quot;Select * from v_parameters where dataset_id = {} and {} = &#39;{}&#39;&quot;.format(db.DATASET_ID, cn.PAR_LABEL_COLUMN, par_label)</span>
    <span class="c1">#    df = db.execute_query(query)</span>
    <span class="c1">#    return  df.at[0, cn.PAR_NAME_COLUMN]</span>

<div class="viewcode-block" id="Parameters.render_all_parameters_table"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.render_all_parameters_table">[docs]</a>    <span class="k">def</span> <span class="nf">render_all_parameters_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is invoked, if no parameter filter is set. A single table including the metadata of all parameters</span>
<span class="sd">        is shown in the view panel&quot;&quot;&quot;</span>

        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select parameter_name as Name, formula as Formula, unit as Unit, formula_Weight as FMW, valency as Valency, description</span>
<span class="s2">            from envdata.v_parameters where dataset_id = </span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;All parameters (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.get_value"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.get_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a metadata value from the parameter table for a specified parameter</span>
<span class="sd">        in: parameter id</span>
<span class="sd">            field name</span>
<span class="sd">        out: metadata value for parameter id</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select </span><span class="si">{}</span><span class="s2"> from v_parameters where dataset_id = </span><span class="si">{}</span><span class="s2"> and parameter_name = &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">,</span>
                                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span>
                                                                                                     <span class="n">parameter</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">field</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Parameters.render_multi_parameters_table"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.render_multi_parameters_table">[docs]</a>    <span class="k">def</span> <span class="nf">render_multi_parameters_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lis_par</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is invoked, if the parameter filter is set and multiple parameters are selected.</span>
<span class="sd">        The following tables are shown:</span>
<span class="sd">        * parameters metadata</span>
<span class="sd">        * parameter value summary per station</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># get list of parameters: if no filter is set: all parameters</span>
        <span class="c1"># if parameters_group filter is set but no individual parameters: list froam parameter group</span>
        <span class="c1"># if individual parameters are specified: those</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis_par</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">filters_multilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">get_expression</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="s1">&#39;and &#39;</span> <span class="o">+</span> <span class="n">criteria</span> <span class="k">if</span> <span class="n">criteria</span> <span class="o">&gt;</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis_par</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_cs_item_list</span><span class="p">(</span><span class="n">lis_par</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="s1">&#39; and parameter_name in (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_table</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;Parameters (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">get_table_download_link</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.get_parameter_table"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.get_parameter_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns a DataFrame holding summary values for samples matching the specified</span>
<span class="sd">        in: </span>
<span class="sd">        criteria: where clause of sql statement</span>

<span class="sd">        out</span>
<span class="sd">        DataFrame with summary information on parameter and station</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">cn</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select t1.parameter_name, t1.formula, t1.unit, t2.min_value, t2.max_value, t2.average_value, t2.number_of_values,</span>
<span class="s2">                t2.number_of_stations as stations, t2.first_year as &#39;First year&#39;, t2.last_year as &#39;Last year&#39;, t2.number_of_years as &#39;Number of years&#39;</span>
<span class="s2">            from </span>
<span class="s2">                envdata.v_parameters t1</span>
<span class="s2">                inner join (select parameter_id, min(calc_value) min_value, max(calc_value) max_value, avg(calc_value) average_value, </span>
<span class="s2">                count(*) as number_of_values, count(distinct station_id) as number_of_stations, min(year(sample_date)) as first_year, </span>
<span class="s2">                max(year(sample_date)) as last_year, count(distinct year(sample_date)) as number_of_years</span>
<span class="s2">                from </span>
<span class="s2">                envdata.v_observations_complete </span>
<span class="s2">            where dataset_id = </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> group by parameter_id) t2 on t2.parameter_id = t1.id&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select t1.parameter_name, t1.unit, t2.min_value, t2.max_value, t2.average_value, t2.number_of_values,</span>
<span class="s2">                t2.number_of_stations as stations, t2.first_year as &#39;First year&#39;, t2.last_year as &#39;Last year&#39;, t2.number_of_years as &#39;Number of years&#39;</span>
<span class="s2">            from </span>
<span class="s2">                envdata.v_parameters t1</span>
<span class="s2">                inner join (select parameter_id, min(calc_value) min_value, max(calc_value) max_value, avg(calc_value) average_value, </span>
<span class="s2">                count(*) as number_of_values, count(distinct station_id) as number_of_stations, min(year(sample_date)) as first_year, </span>
<span class="s2">                max(year(sample_date)) as last_year, count(distinct year(sample_date)) as number_of_years</span>
<span class="s2">                from </span>
<span class="s2">                envdata.v_time_series </span>
<span class="s2">            where dataset_id = </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> group by parameter_id) t2 on t2.parameter_id = t1.id&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Parameters.get_parameter_summary_table"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.get_parameter_summary_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_summary_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns a DataFrame holding summary values for samples matching the specified</span>
<span class="sd">        in: </span>
<span class="sd">        criteria: where clause of sql statement</span>

<span class="sd">        out</span>
<span class="sd">        DataFrame with summary information on parameter and station</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">cn</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select t2.station as Station, t2.min_value, t2.max_value, t2.average_value, t2.number_of_values,</span>
<span class="s2">                t2.first_year as &#39;First year&#39;, t2.last_year as &#39;Last year&#39;, t2.number_of_years as &#39;Number of years&#39;</span>
<span class="s2">            from </span>
<span class="s2">                envdata.v_parameters t1</span>
<span class="s2">                inner join (select parameter_id, station_name as station, min(calc_value) min_value, max(calc_value) max_value, avg(calc_value) average_value, </span>
<span class="s2">                count(*) as number_of_values, min(year(sample_date)) as first_year, </span>
<span class="s2">                max(year(sample_date)) as last_year, count(distinct year(sample_date)) as number_of_years</span>
<span class="s2">                from </span>
<span class="s2">                envdata.v_observations</span>
<span class="s2">            where dataset_id = </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> group by parameter_name, station) t2 on t2.parameter_id = t1.id&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select t2.station as Station, t2.min_value, t2.max_value, t2.average_value, t2.number_of_values,</span>
<span class="s2">                t2.first_year as &#39;First year&#39;, t2.last_year as &#39;Last year&#39;, t2.number_of_years as &#39;Number of years&#39;</span>
<span class="s2">            from </span>
<span class="s2">                envdata.v_parameters t1</span>
<span class="s2">                inner join (select parameter_id, station_name as station, min(calc_value) min_value, max(calc_value) max_value, avg(calc_value) average_value, </span>
<span class="s2">                    count(*) as number_of_values, min(year(sample_date)) as first_year, </span>
<span class="s2">                    max(year(sample_date)) as last_year, count(distinct year(sample_date)) as number_of_years</span>
<span class="s2">                    from </span>
<span class="s2">                    envdata.v_time_series</span>
<span class="s2">            where dataset_id = </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> group by parameter_name, station) t2 on t2.parameter_id = t1.id&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Parameters.get_map_table"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.get_map_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_map_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; bla &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">parameter</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select lat, lon, station_name, 2 as value from v_stations where id in (select distinct station_id from v_observations</span>
<span class="s2">            where parameter_name = &#39;</span><span class="si">{}</span><span class="s2">&#39;)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">cn</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select lat, lon, station_name, t2.value from v_stations t1 inner join (select station_id, avg(calc_value) as value from v_observations</span>
<span class="s2">            where dataset_id = </span><span class="si">{}</span><span class="s2"> group by station_id) t2 on t2.station_id = t1.id where coalesce(t1.lat, 0)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select lat, lon, station_name, t2.value from v_stations t1 inner join (select station_id, avg(calc_value) as value from v_time_series</span>
<span class="s2">            where dataset_id = </span><span class="si">{}</span><span class="s2"> group by station_id) t2 on t2.station_id = t1.id where coalesce(t1.lat, 0)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Parameters.render_single_parameters_table"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.render_single_parameters_table">[docs]</a>    <span class="k">def</span> <span class="nf">render_single_parameters_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is invoked, if the parameter filter is set and multiple parameters are selected.</span>
<span class="sd">        The following tables are shown:</span>
<span class="sd">        * parameters metadata</span>
<span class="sd">        * parameter value summary per station</span>
<span class="sd">        * a map</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># transposed info table on parameter</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="n">lis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="s2">&quot; and parameter_name = &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lis</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_table</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">transpose_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;### </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameter</span><span class="p">))</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">href</span> <span class="o">=</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">{}</span><span class="s1">&quot; target = &quot;_blank&quot;&gt;More information (source: NIH-TOXNET)&lt;/a&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">href</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># parameter-station values summary table</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_summary_table</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;### </span><span class="si">{}</span><span class="s2"> per station&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameter</span><span class="p">))</span>
            <span class="n">st</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="c1"># st.markdown(tools.get_table_download_link(df), unsafe_allow_html=True)</span>

            <span class="c1"># map of locations where values can be found</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_map_table</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Map avg (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
            <span class="c1"># make sure the station as coordinates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Please select at least one parameter&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.render_menu"><a class="viewcode-back" href="../fontus.html#fontus.Parameters.render_menu">[docs]</a>    <span class="k">def</span> <span class="nf">render_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The function renders the sidebar menu for the parameters option menu item&quot;&quot;&quot;</span>

        <span class="c1"># sidebar menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">render_menu</span><span class="p">()</span>

        <span class="c1"># df.reset_index(inplace = True) #needed so station_name can be selected on plotly table</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># st.write(self.__parent.filter.station_fields_multilist.keys)</span>
        <span class="k">if</span> <span class="s1">&#39;parameter&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">:</span>
            <span class="n">lis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">[</span><span class="s1">&#39;parameter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">render_multi_parameters_table</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_single_parameters_table</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_multi_parameters_table</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span></div></div>

        <span class="c1"># df = df.set_index(cn.PAR_NAME_COLUMN)</span>
        <span class="c1"># df = df[[cn.PAR_NAME_COLUMN, cn.PAR_LABEL_COLUMN, cn.PAR_UNIT_COLUMN]]</span>
        <span class="c1"># values = [df[cn.PAR_NAME_COLUMN], df[cn.PAR_LABEL_COLUMN], df[cn.PAR_UNIT_COLUMN]]</span>
        <span class="c1"># txt.show_table(df, values)</span>
        <span class="c1"># st.write(&quot;{} parameters found in stations {}&quot;.format(len(df.index), &#39;,&#39;.join(ctrl[&#39;station_list_multi&#39;]) ))</span>


<div class="viewcode-block" id="Plots"><a class="viewcode-back" href="../fontus.html#fontus.Plots">[docs]</a><span class="k">class</span> <span class="nc">Plots</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This class is used to generate plots and render plot related UI controls&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_groupby</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__marker_groupby</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">=</span> <span class="s1">&#39;bar chart&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_data_table</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_width</span> <span class="o">=</span> <span class="n">cn</span><span class="o">.</span><span class="n">plot_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_height</span> <span class="o">=</span> <span class="n">cn</span><span class="o">.</span><span class="n">plot_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xpar</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__define_axis_limits</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xax_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xax_max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bin_size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">xpar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the x parameter for plots having a specified x axis&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xpar</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ypar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the y parameter for a plot&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plot_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span>

    <span class="nd">@plot_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">plot_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets the plot type. For time series plots, the def sets the</span>
<span class="sd">        filter checkbox to true, so not all values from all stations are retrieved  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;time series&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span> <span class="o">=</span> <span class="s1">&#39;station&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_filters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Plots.render_menu"><a class="viewcode-back" href="../fontus.html#fontus.Plots.render_menu">[docs]</a>    <span class="k">def</span> <span class="nf">render_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render_controls</span><span class="p">()</span>
        <span class="n">criteria_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">get_expression</span>
        <span class="n">criteria_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">append_parameter_filter</span><span class="p">(</span><span class="n">criteria_base</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_groupby</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria_base</span>
            <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_groupby</span> <span class="o">==</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;select distinct </span><span class="si">{}</span><span class="s1"> from v_observations where </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">YEAR_COLUMN</span><span class="p">,</span> <span class="n">criteria_base</span><span class="p">)</span>
            <span class="n">year_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="n">cn</span><span class="o">.</span><span class="n">YEAR_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">year_list</span><span class="p">:</span>
                <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria_base</span> <span class="o">+</span> <span class="s2">&quot; AND </span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">YEAR_COLUMN</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
                <span class="n">tit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_groupby</span> <span class="o">==</span> <span class="s1">&#39;season&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">cn</span><span class="o">.</span><span class="n">season_list</span><span class="p">:</span>
                <span class="n">crit</span> <span class="o">=</span> <span class="n">criteria_base</span> <span class="o">+</span> <span class="s2">&quot; AND </span><span class="si">{0}</span><span class="s2"> = &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">SEASON_COLUMN</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
                <span class="n">tit</span> <span class="o">=</span> <span class="n">group</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">crit</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_groupby</span> <span class="o">==</span> <span class="s1">&#39;aquifer_type&#39;</span><span class="p">:</span>
            <span class="n">lis</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_distinct_values</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">AQUIFER_TYPE_COLUMN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">observations_view</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">criteria_base</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">:</span>
                <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria_base</span> <span class="o">+</span> <span class="s2">&quot; AND </span><span class="si">{0}</span><span class="s2"> = &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">AQUIFER_TYPE_COLUMN</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
                <span class="n">tit</span> <span class="o">=</span> <span class="n">group</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_groupby</span> <span class="o">==</span> <span class="n">cn</span><span class="o">.</span><span class="n">STATION_NAME_COLUMN</span><span class="p">:</span>
            <span class="c1"># if a station filter is set, then loop through these stations otherwise loop through all stations</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">list_of_stations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">list_of_stations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_fields_multilist</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span>

            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">list_of_stations</span><span class="p">:</span>
                <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria_base</span> <span class="o">+</span> <span class="s2">&quot; AND </span><span class="si">{0}</span><span class="s2"> = &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">STATION_NAME_COLUMN</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
                <span class="n">tit</span> <span class="o">=</span> <span class="n">group</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>

                <span class="c1"># todo: move to plot def</span>
                <span class="c1"># if (len(plot_results[1]) &gt; 0):</span>
                <span class="c1">#    st.write(plot_results[0].properties(width = self.__plot_width, height = self.__plot_height))</span>
                <span class="c1">#    # if a station has been selected display a link to visit site on google maps</span>
                <span class="c1">#    if not filter_stations_cb and len(self.__parent.filter.station_multilist) == 1:</span>
                <span class="c1">#        stations.dfStations.set_index(cn.STATION_NAME_COLUMN, inplace = True)</span>
                <span class="c1">#        lat = stations.dfStations.at[self.ctrl[&#39;station&#39;],&#39;lat&#39;]</span>
                <span class="c1">#        lon = stations.dfStations.at[self.ctrl[&#39;station&#39;],&#39;lon&#39;]</span>
                <span class="c1">#        loc = stations.dfStations.at[self.ctrl[&#39;station&#39;],&#39;LOCATION&#39;]</span>
                <span class="c1">#        lnk = &#39;Location: {0}. [Visit station on GOOGLE maps](https://www.google.com/maps/search/?api=1&amp;query={1},{2} &quot;open in GOOGLE maps&quot;)&#39;.format(loc, lat, lon)</span>
                <span class="c1">#        st.markdown(lnk)</span>
                <span class="c1">#    if self.__show_data_table:</span>
                <span class="c1">#        st.dataframe(plot_results[1])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># map plot</span>
            <span class="n">crit</span> <span class="o">=</span> <span class="n">criteria_base</span>
            <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39;Map&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">tit</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">crit</span><span class="p">)</span></div>

            <span class="c1"># df = self.__parent.stations.dfStations</span>
            <span class="c1"># if len(self.__parent.filter.station_multilist) == 1:</span>
            <span class="c1">#    pass</span>
            <span class="c1"># elif len(self.__parent.filter.station_multilist) &gt; 1:</span>
            <span class="c1">#    df = stations.dfStations[(df[&#39;id&#39;].isin(self.__parent.filter.station_multilist))]</span>
            <span class="c1">#    df = df[(df[&#39;id&#39;] == self.ctrl[&#39;station&#39;])]</span>
            <span class="c1"># </span>
            <span class="c1"># if df.shape[0] &gt; 0:</span>
            <span class="c1">#    self.plot_map(df)</span>
            <span class="c1">#    st.write(&#39;if map appears empty, use mouse wheel to zoom out, until markers appear.&#39;)</span>
            <span class="c1"># else:</span>
            <span class="c1">#    st.write(&#39;Insufficient data&#39;)</span>

    <span class="c1"># returns the label for a given parameter key. </span>
<div class="viewcode-block" id="Plots.get_label"><a class="viewcode-back" href="../fontus.html#fontus.Plots.get_label">[docs]</a>    <span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_id</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">dfParameters</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">par_id</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">PAR_LABEL_COLUMN</span><span class="p">]</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">dfParameters</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">par_id</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">PAR_UNIT_COLUMN</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plots.plot"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">criteria</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">stations</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;scatter plot&#39;</span><span class="p">:</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;time series&#39;</span><span class="p">:</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_time_series</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;histogram&#39;</span><span class="p">:</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;box plot&#39;</span><span class="p">:</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_boxplot</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;schoeller&#39;</span><span class="p">:</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_schoeller</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;bar chart&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_bar_h</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;bar chart&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_bar_v</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># verify if the result list has items</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">plot_results</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">plot_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__plot_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__plot_height</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__show_data_table</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">plot_results</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">get_table_download_link</span><span class="p">(</span><span class="n">plot_results</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plot &#39;</span><span class="si">{}</span><span class="s2">&#39; could not be generated: insufficient data&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span></div>

<div class="viewcode-block" id="Plots.plot_schoeller"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot_schoeller">[docs]</a>    <span class="k">def</span> <span class="nf">plot_schoeller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; todo: schoeller plot&quot;&quot;&quot;</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#### </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s1">&#39;count()&#39;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">transform_fold</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;petalLength&#39;</span><span class="p">,</span> <span class="s1">&#39;petalWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;sepalLength&#39;</span><span class="p">,</span> <span class="s1">&#39;sepalWidth&#39;</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;key:N&#39;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span> <span class="o">+</span> <span class="s1">&#39;:Q&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;species:N&#39;</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s1">&#39;index:N&#39;</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">base</span></div>

<div class="viewcode-block" id="Plots.plot_boxplot"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot_boxplot">[docs]</a>    <span class="k">def</span> <span class="nf">plot_boxplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">)</span>
        <span class="n">x_lab</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">:</span>
            <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span><span class="p">))</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">mark_boxplot</span><span class="p">(</span><span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:O&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">x_lab</span><span class="p">),</span>  <span class="c1"># , axis=alt.Axis(labelAngle=0)</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:Q&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">y_lab</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scy</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Plots.plot_histogram"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot_histogram">[docs]</a>    <span class="k">def</span> <span class="nf">plot_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">)</span>
        <span class="c1"># df = df[(df[cn.PAR_NAME_COLUMN] == self.__ypar) &amp; (df[cn.VALUES_VALUE_COLUMN] &gt; 0)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">STATION_NAME_COLUMN</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span><span class="p">]]</span>
        <span class="n">brush</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="n">encodings</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xax_max</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xax_min</span><span class="p">:</span>
            <span class="n">scx</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scx</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xax_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xax_max</span><span class="p">))</span>
        <span class="c1"># use bin width if user defined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bin_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bin_def</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__bin_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bin_def</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">maxbins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">clip</span><span class="o">=</span><span class="kc">True</span>
                                                       <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:Q&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">),</span> <span class="nb">bin</span><span class="o">=</span><span class="n">bin_def</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">x_lab</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scx</span><span class="p">),</span>
                <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;count()&#39;</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span>
                <span class="n">opacity</span><span class="o">=</span><span class="n">cn</span><span class="o">.</span><span class="n">OPACITY</span><span class="p">,</span>
                <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">interpolate</span><span class="o">=</span><span class="s1">&#39;step&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:Q&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">),</span> <span class="nb">bin</span><span class="o">=</span><span class="n">bin_def</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">x_lab</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scx</span><span class="p">),</span>
                <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;count()&#39;</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:N&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Plots.plot_bar_h"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot_bar_h">[docs]</a>    <span class="k">def</span> <span class="nf">plot_bar_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">)</span>
        <span class="c1"># df = df[(df[cn.PAR_NAME_COLUMN] == self.__ypar) &amp; (df[cn.VALUES_VALUE_COLUMN] &gt; 0)]</span>
        <span class="c1"># brush = alt.selection(type=&#39;interval&#39;, encodings=[&#39;x&#39;])</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">):</span>
            <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span><span class="p">])</span>

        <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:O&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;mean(</span><span class="si">{0}</span><span class="s1">):Q&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">y_lab</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scy</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">avg</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean(</span><span class="si">{0}</span><span class="s1">):Q&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">avg</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Plots.plot_bar_v"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot_bar_v">[docs]</a>    <span class="k">def</span> <span class="nf">plot_bar_v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">)</span>
        <span class="c1"># df = df[(df[cn.PAR_NAME_COLUMN] == self.__ypar) &amp; (df[cn.VALUES_VALUE_COLUMN] &gt; 0)]</span>
        <span class="c1"># brush = alt.selection(type=&#39;interval&#39;, encodings=[&#39;x&#39;])</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">):</span>
            <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span><span class="p">])</span>

        <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:O&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;mean(</span><span class="si">{0}</span><span class="s1">):Q&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">y_lab</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scy</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">avg</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(</span><span class="si">{0}</span><span class="s1">):Q&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">avg</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Plots.plot_map"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot_map">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_map</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">layer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;HexagonLayer&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a map plot</span>

<span class="sd">        :param layer_type: HexagonLayer or ScatterplotLayer</span>
<span class="sd">        :param title: title of plot</span>
<span class="sd">        :param df: dataframe with data to be plotted</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">LATITUDE_COLUMN</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">LONGITUDE_COLUMN</span><span class="p">]))</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;#### </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s1">&#39;HexagonLayer&#39;</span><span class="p">:</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">max_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">color_gradient_</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">layer</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span>
                    <span class="s1">&#39;HexagonLayer&#39;</span><span class="p">,</span>
                    <span class="n">df</span><span class="p">,</span>
                    <span class="n">get_position</span><span class="o">=</span><span class="s2">&quot;[lon, lat]&quot;</span><span class="p">,</span>
                    <span class="n">auto_highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">elevation_scale</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                    <span class="n">pickable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">elevation_range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">],</span>
                    <span class="n">extruded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">coverage</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="c1"># getFillColor = &#39;[color]&#39;,</span>
                    <span class="n">getColorR</span><span class="o">=</span><span class="s1">&#39;color[0]&#39;</span><span class="p">,</span>
                    <span class="n">getColorG</span><span class="o">=</span><span class="s1">&#39;color[1]&#39;</span><span class="p">,</span>
                    <span class="n">getColorB</span><span class="o">=</span><span class="s1">&#39;color[2]&#39;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s1">&#39;ScatterplotLayer&#39;</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="n">layer</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span>
                    <span class="s1">&#39;ScatterplotLayer&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                    <span class="n">get_position</span><span class="o">=</span><span class="s2">&quot;[lon, lat]&quot;</span><span class="p">,</span>
                    <span class="n">get_radius</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                    <span class="n">get_fill_color</span><span class="o">=</span><span class="s1">&#39;[180, 0, 200, 140]&#39;</span><span class="p">,</span>  <span class="c1"># Set an RGBA value for fill</span>
                <span class="p">)</span>
            <span class="n">view_state</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">ViewState</span><span class="p">(</span>
                <span class="n">longitude</span><span class="o">=</span><span class="n">midpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">latitude</span><span class="o">=</span><span class="n">midpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">min_zoom</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_zoom</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=-</span><span class="mf">27.36</span>
            <span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Deck</span><span class="p">(</span>
                <span class="n">map_style</span><span class="o">=</span><span class="n">cn</span><span class="o">.</span><span class="n">MAPBOX_STYLE</span><span class="p">,</span>
                <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="n">layer</span><span class="p">],</span>
                <span class="n">initial_view_state</span><span class="o">=</span><span class="n">view_state</span><span class="p">,</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;b&gt;Value:&lt;/b&gt; </span><span class="si">{value}</span><span class="s2"> &lt;br/&gt;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;backgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;steelblue&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">}</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="s2">&quot;test.html&quot;</span><span class="p">,</span> <span class="n">open_browser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">notebook_display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">pydeck_chart</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Unable to create map: no location data was found&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plots.plot_time_series"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">plot_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Plots a time series plot. input: title: plot title, df: datafram with the data, ctrl: list of GUI controls&quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_lab</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">y_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">:</span>
            <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span><span class="p">))</span>

        <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">has_markers</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:T&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">SAMPLE_DATE_COLUMN</span><span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:Q&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">),</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">scy</span><span class="p">,</span>
                    <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">y_lab</span><span class="p">)</span>
                    <span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">STATION_NAME_COLUMN</span><span class="p">,</span>
                            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">scheme</span><span class="o">=</span><span class="n">cn</span><span class="o">.</span><span class="n">color_schema</span><span class="p">)</span>
                            <span class="p">),</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">STATION_NAME_COLUMN</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">SAMPLE_DATE_COLUMN</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">VALUES_VALUE_COLUMN</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Plots.plot_scatter"><a class="viewcode-back" href="../fontus.html#fontus.Plots.plot_scatter">[docs]</a>    <span class="k">def</span> <span class="nf">plot_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># remove value &lt; 0</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_pivot_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># verify that both parameter exist as column names</span>
        <span class="n">x_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">parameters_display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__xpar</span><span class="p">]</span>
        <span class="n">y_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">parameters_display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">]</span>

        <span class="n">ok</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x_col</span><span class="p">,</span> <span class="n">y_col</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="c1"># filter for NAN values</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">x_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">x_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xpar</span><span class="p">)</span>
            <span class="n">y_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xax_max</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xax_min</span><span class="p">:</span>
                <span class="n">scx</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scx</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xax_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xax_max</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">:</span>
                <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scy</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span><span class="p">))</span>

            <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">cn</span><span class="o">.</span><span class="n">symbol_size</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">x_col</span> <span class="o">+</span> <span class="s1">&#39;:Q&#39;</span><span class="p">,</span>
                        <span class="n">scale</span><span class="o">=</span><span class="n">scx</span><span class="p">,</span>
                        <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">x_lab</span><span class="p">)),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">y_col</span> <span class="o">+</span> <span class="s1">&#39;:Q&#39;</span><span class="p">,</span>
                        <span class="n">scale</span><span class="o">=</span><span class="n">scy</span><span class="p">,</span>
                        <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">y_lab</span><span class="p">)),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:O&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span><span class="p">),</span>
                                <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">scheme</span><span class="o">=</span><span class="n">cn</span><span class="o">.</span><span class="n">color_schema</span><span class="p">)</span>
                                <span class="p">),</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">cn</span><span class="o">.</span><span class="n">SAMPLE_DATE_COLUMN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span><span class="p">,</span> <span class="n">x_col</span><span class="p">,</span> <span class="n">y_col</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">empty_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">empty_df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">cn</span><span class="o">.</span><span class="n">symbol_size</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Plots.render_controls"><a class="viewcode-back" href="../fontus.html#fontus.Plots.render_controls">[docs]</a>    <span class="k">def</span> <span class="nf">render_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">render_time_filter</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot; renders the controls for the time filter to ensure that the user may only filter by 1 time control&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">filter_by_season_cb</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">filter_by_year_cb</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">checkbox</span><span class="p">(</span><span class="s1">&#39;Filter data by year&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                             <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">filter_by_year_cb</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">year_slider</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">first_year</span><span class="p">),</span>
                                                                     <span class="n">max_value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">last_year</span><span class="p">),</span>
                                                                     <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">year_slider</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">render_group_by_controls</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;Group by controls for plots and markers&quot;&quot;&quot;</span>

            <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;#### Plot group and marker settings&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__plot_groupby</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s1">&#39;Group plots by&#39;</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">group_by_options</span><span class="p">,</span>
                                                       <span class="n">format_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cn</span><span class="o">.</span><span class="n">group_by_display</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;time series&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span> <span class="o">=</span> <span class="s1">&#39;station&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__marker_group_by</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s1">&#39;Group markers by&#39;</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">group_by_options</span><span class="p">,</span>
                                                              <span class="n">format_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cn</span><span class="o">.</span><span class="n">group_by_display</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">render_options</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;Renders plot specific options controls such as pameters or number of bins for histograms.&quot;&quot;&quot;</span>

            <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s1">&#39;#### Plot and axis settings&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time series&#39;</span><span class="p">,</span> <span class="s1">&#39;histogram&#39;</span><span class="p">,</span> <span class="s1">&#39;box plot&#39;</span><span class="p">,</span> <span class="s1">&#39;bar chart&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xpar</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s1">&#39;X-parameter&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">parameters_options</span><span class="p">,</span>
                                                   <span class="n">format_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">parameters_display</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s1">&#39;Y-parameter&#39;</span><span class="p">,</span>
                                                   <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">parameters_options</span><span class="p">,</span>
                                                   <span class="n">format_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">parameters_display</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;histogram&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bin_size</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s1">&#39;Bin width&#39;</span><span class="p">)</span>

            <span class="c1"># various plot settings such as axis length, min max on axis etc</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;bar chart&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__direction</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">radio</span><span class="p">(</span><span class="s1">&#39;Bars&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time series&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xax_min</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s1">&#39;Minimum X&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xax_max</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s1">&#39;Maximum X&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__yax_min</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s1">&#39;Minimum y&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__yax_max</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s1">&#39;Maximum y&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__define_axis_length</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">checkbox</span><span class="p">(</span><span class="s1">&#39;Define axis length&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__define_axis_length</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__plot_width</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s1">&#39;Width (pixel)&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__plot_width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__plot_height</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s1">&#39;Height (pixel)&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__plot_height</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__show_data_table</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">checkbox</span><span class="p">(</span><span class="s1">&#39;Show data table&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s1">&#39;Plot type&#39;</span><span class="p">,</span> <span class="n">cn</span><span class="o">.</span><span class="n">plot_type_list</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">render_group_by_controls</span><span class="p">()</span>
        <span class="n">render_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">render_menu</span><span class="p">()</span></div>

        <span class="c1"># st.sidebar.markdown(&#39;#### Filter&#39;)</span>
        <span class="c1"># filter for stations</span>
        <span class="c1"># if self.__plot_type == &#39;time series&#39;:</span>
        <span class="c1">#    self.__parent.filter.filter_stations_cb = True</span>
        <span class="c1"># else:</span>
        <span class="c1">#    self.__parent.filter.filter_stations_cb = st.sidebar.checkbox(&#39;Filter data by station&#39;, value=self.__parent.filter.filter_stations_cb, key = None)</span>
        <span class="c1">#</span>
        <span class="c1"># if self.__parent.filter.station_filters == []:</span>
        <span class="c1">#    self.__parent.filter.station_multilist = st.sidebar.multiselect(label = cn.STATION_WIDGET_NAME,</span>
        <span class="c1">#        default = self.__parent.stations.stations_options[0],</span>
        <span class="c1">#        options = self.__parent.stations.stations_options, </span>
        <span class="c1">#        format_func=lambda x: self.__parent.stations.stations_display[x])</span>

        <span class="c1"># filter for month or year, this is hidden for plot type time series</span>
        <span class="c1"># if self.__plot_type not in [&#39;time series&#39;]:</span>
        <span class="c1">#    render_time_filter()</span>
        <span class="c1">#</span>

<div class="viewcode-block" id="Plots.get_criteria_expression"><a class="viewcode-back" href="../fontus.html#fontus.Plots.get_criteria_expression">[docs]</a>    <span class="k">def</span> <span class="nf">get_criteria_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;creates the sql where clause for the set filter controls&quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;dataset_id = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_filters</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">selected_station_list</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_cs_item_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">station_multilist</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
                                                           <span class="n">quote_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; AND </span><span class="si">{0}</span><span class="s2"> in (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="n">selected_station_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">filter_by_season_cb</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; AND </span><span class="si">{0}</span><span class="s2"> = &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">SEASON_COLUMN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">season_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">filter_by_year_cb</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">year_slider</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">year_slider</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; AND </span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">YEAR_COLUMN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">year_slider</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; AND (</span><span class="si">{0}</span><span class="s2"> &gt;= </span><span class="si">{1}</span><span class="s2"> AND </span><span class="si">{0}</span><span class="s2"> &lt;= </span><span class="si">{2}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cn</span><span class="o">.</span><span class="n">YEAR_COLUMN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">year_slider</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">__parent</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">year_slider</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;scatter plot&#39;</span><span class="p">:</span>
            <span class="n">par_list</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_cs_item_list</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__xpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">])</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; AND </span><span class="si">{}</span><span class="s2"> in (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;parameter_id&#39;</span><span class="p">,</span> <span class="n">par_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_type</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; AND lat is not null and lon is not null and not (lat = 0 and lon = 0)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot; AND </span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;parameter_id&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ypar</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">ede  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Lukas Calmbach.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>